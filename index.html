<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>libgit.c</title>
  <link rel="stylesheet" href="http://github.com/jashkenas/docco/raw/0.3.0/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>libgit.c</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p><a href="http://libgit2.github.com"><strong>libgit2</strong></a> is a portable, pure C implementation of the Git core methods
provided as a re-entrant linkable library with a solid API, allowing you
to write native speed custom Git applications in any language which
supports C bindings.</p>

<p><a href="http://github.com/schacon/libgit2-examples">This file</a> is an example of using that API in a real, compilable C file.
Before published, this file is compiled and run to make sure it actually
runs.  As the API is updated, this file will be updated to demonstrate the
new functionality. This project is <a href="http://github.com/schacon/libgit2-examples">on GitHub</a>.</p>

<p>If you&rsquo;re trying to write something in C using <a href="http://libgit2.github.com">libgit2</a>, you will also want
to check out the generated <a href="http://libgit2.github.com/libgit2/modules.html">API documentation</a> and the <a href="http://libgit2.github.com/api.html">Usage Guide</a>. We&rsquo;ve
tried to link to the relevant sections of the API docs in each section in this file.</p>

<p><strong>libgit2</strong> only implements the core plumbing functions, not really the higher
level porcelain stuff. For a primer on Git Internals that you will need to know
to work with Git at this level, check out <a href="http://progit.org/book/ch9-0.html">Chapter 9</a> of the Pro Git book.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Includes'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Includes">&#182;</a>
        </div>
        <h3>Includes</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>Including the <code>git2.h</code> header will include all the other libgit2 headers that you need.
It should be the only thing you need to include in order to compile properly and get
all the libgit2 API.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="cp">#include &lt;git2.h&gt;</span>
<span class="cp">#include &lt;stdio.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-Opening_the_Repository'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Opening_the_Repository">&#182;</a>
        </div>
        <h3>Opening the Repository</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>There are a couple of methods for opening a repository, this being the simplest.
There are also <a href="http://libgit2.github.com/libgit2/group__git__repository.html">methods</a> for specifying the index file and work tree locations, here
we are assuming they are in the normal places.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_repository</span> <span class="o">*</span><span class="n">repo</span><span class="p">;</span>
  <span class="n">git_repository_open</span><span class="p">(</span><span class="o">&amp;</span><span class="n">repo</span><span class="p">,</span> <span class="s">&quot;/opt/libgit2-test/.git&quot;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-SHA-1_Value_Conversions'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-SHA-1_Value_Conversions">&#182;</a>
        </div>
        <h3>SHA-1 Value Conversions</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>For our first example, we will convert a 40 character hex value to the 20 byte raw SHA1 value.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;*Hex to Raw*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="kt">char</span> <span class="n">hex</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;fd6e612585290339ea8bf39c692a7ff6a29cb7c3&quot;</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>The <code>git_oid</code> is the structure that keeps the SHA value. We will use this throughout the example
for storing the value of the current SHA key we&rsquo;re working with.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid</span> <span class="n">oid</span><span class="p">;</span>
  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="n">hex</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Once we&rsquo;ve converted the string into the oid value, we can get the raw value of the SHA.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Raw 20 bytes: [%s]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>Next we will convert the 20 byte raw SHA1 value to a human readable 40 char hex value.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Raw to Hex*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="kt">char</span> <span class="n">out</span><span class="p">[</span><span class="mi">41</span><span class="p">];</span>
  <span class="n">out</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>If you have a oid, you can easily get the hex value of the SHA as well.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid_fmt</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;SHA hex string: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Working_with_the_Object_Database'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Working_with_the_Object_Database">&#182;</a>
        </div>
        <h3>Working with the Object Database</h3>

<p><strong>libgit2</strong> provides <a href="http://libgit2.github.com/libgit2/group__git__odb.html">direct access</a> to the object database.
The object database is where the actual objects are stored in Git. For
working with raw objects, we&rsquo;ll need to get this structure from the
repository.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_odb</span> <span class="o">*</span><span class="n">odb</span><span class="p">;</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">git_repository_database</span><span class="p">(</span><span class="n">repo</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Raw_Object_Reading'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Raw_Object_Reading">&#182;</a>
        </div>
        <h4>Raw Object Reading</h4>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Raw Object Read*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">git_odb_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">;</span>
  <span class="n">git_otype</span> <span class="n">otype</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str_type</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">error</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>We can read raw objects directly from the object database if we have the oid (SHA)
of the object.  This allows us to access objects without knowing thier type and inspect
the raw bytes unparsed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">error</span> <span class="o">=</span> <span class="n">git_odb_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obj</span><span class="p">,</span> <span class="n">odb</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>A raw object only has three properties &ndash; the type (commit, blob, tree or tag), the size
of the raw data and the raw, unparsed data itself.  For a commit or tag, that raw data
is human readable plain ASCII text. For a blob it is just file contents, so it could be
text or binary data. For a tree it is a special binary format, so it&rsquo;s unlikely to be
hugely helpful as a raw object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">git_odb_object_data</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
  <span class="n">otype</span> <span class="o">=</span> <span class="n">git_odb_object_type</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>We provide methods to convert from the object type which is an enum, to a string
representation of that value (and vice-versa).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">str_type</span> <span class="o">=</span> <span class="n">git_object_type2string</span><span class="p">(</span><span class="n">otype</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;object length and type: %d, %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
      <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">git_odb_object_size</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span>
      <span class="n">str_type</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>For proper memory management, close the object when you are done with it or it will leak
memory.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_odb_object_close</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Raw_Object_Writing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Raw_Object_Writing">&#182;</a>
        </div>
        <h4>Raw Object Writing</h4>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Raw Object Write*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>You can also write raw object data to Git. This is pretty cool because it gives you
direct access to the key/value properties of Git.  Here we&rsquo;ll write a new blob object
that just contains a simple string.  Notice that we have to specify the object type as
the <code>git_otype</code> enum.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_odb_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="n">odb</span><span class="p">,</span> <span class="s">&quot;test data&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">GIT_OBJ_BLOB</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>Now that we&rsquo;ve written the object, we can check out what SHA1 was generated when the
object was written to our database.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid_fmt</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Written Object: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Object_Parsing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Object_Parsing">&#182;</a>
        </div>
        <h3>Object Parsing</h3>

<p>libgit2 has methods to parse every object type in Git so you don&rsquo;t have to work directly
with the raw data. This is much faster and simpler than trying to deal with the raw data
yourself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Commit_Parsing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Commit_Parsing">&#182;</a>
        </div>
        <h4>Commit Parsing</h4>

<p><a href="http://libgit2.github.com/libgit2/group__git__commit.html">Parsing commit objects</a> is simple and gives you access to all the data in the commit
&ndash; the // author (name, email, datetime), committer (same), tree, message, encoding and parent(s).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Commit Parsing*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

  <span class="n">git_commit</span> <span class="o">*</span><span class="n">commit</span><span class="p">;</span>
  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="s">&quot;f0877d0b841d75172ec404fc9370173dfffc20d1&quot;</span><span class="p">);</span>

  <span class="n">error</span> <span class="o">=</span> <span class="n">git_commit_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">commit</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>

  <span class="k">const</span> <span class="n">git_signature</span> <span class="o">*</span><span class="n">author</span><span class="p">,</span> <span class="o">*</span><span class="n">cmtter</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span> <span class="o">*</span><span class="n">message_short</span><span class="p">;</span>
  <span class="kt">time_t</span> <span class="n">ctime</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">parents</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Each of the properties of the commit object are accessible via methods, including commonly
needed variations, such as <code>git_commit_time</code> which returns the author time and <code>_message_short</code>
which gives you just the first line of the commit message.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">message</span>  <span class="o">=</span> <span class="n">git_commit_message</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span>
  <span class="n">message_short</span> <span class="o">=</span> <span class="n">git_commit_message_short</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span>
  <span class="n">author</span>   <span class="o">=</span> <span class="n">git_commit_author</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span>
  <span class="n">cmtter</span>   <span class="o">=</span> <span class="n">git_commit_committer</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span>
  <span class="n">ctime</span>    <span class="o">=</span> <span class="n">git_commit_time</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>The author and committer methods return [git_signature] structures, which give you name, email
and <code>when</code>, which is a <code>git_time</code> structure, giving you a timestamp and timezone offset.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Author: %s (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">author</span><span class="o">-&gt;</span><span class="n">email</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>Commits can have zero or more parents. The first (root) commit will have no parents, most commits
will have one, which is the commit it was based on, and merge commits will have two or more.
Commits can technically have any number, though it&rsquo;s pretty rare to have more than two.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">parents</span>  <span class="o">=</span> <span class="n">git_commit_parentcount</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">parents</span><span class="p">;</span><span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">git_commit</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span>
    <span class="n">git_commit_parent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">parent</span><span class="p">,</span> <span class="n">commit</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
    <span class="n">git_oid_fmt</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">git_commit_id</span><span class="p">(</span><span class="n">parent</span><span class="p">));</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Parent: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span>
    <span class="n">git_commit_close</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>Don&rsquo;t forget to close the object to prevent memory leaks. You will have to do this for
all the objects you open and parse.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_commit_close</span><span class="p">(</span><span class="n">commit</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Writing_Commits'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Writing_Commits">&#182;</a>
        </div>
        <h4>Writing Commits</h4>

<p>libgit2 provides a couple of methods to create commit objects easily as well. There are four
different create signatures, we&rsquo;ll just show one of them here.  You can read about the other
ones in the <a href="http://libgit2.github.com/libgit2/group__git__commit.html">commit API docs</a>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Commit Writing*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">git_oid</span> <span class="n">tree_id</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">commit_id</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>Creating signatures for an authoring identity and time is pretty simple &ndash; you will need to have
this to create a commit in order to specify who created it and when.  Default values for the name
and email should be found in the <code>user.name</code> and <code>user.email</code> configuration options.  See the <code>config</code>
section of this example file to see how to access config values.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">author</span> <span class="o">=</span> <span class="n">git_signature_new</span><span class="p">(</span><span class="s">&quot;Scott Chacon&quot;</span><span class="p">,</span> <span class="s">&quot;schacon@gmail.com&quot;</span><span class="p">,</span>
      <span class="mi">123456789</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
  <span class="n">cmtter</span> <span class="o">=</span> <span class="n">git_signature_new</span><span class="p">(</span><span class="s">&quot;Scott A Chacon&quot;</span><span class="p">,</span> <span class="s">&quot;scott@github.com&quot;</span><span class="p">,</span>
      <span class="mi">987654321</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Commit objects need a tree to point to and optionally one or more parents.  Here we&rsquo;re creating oid
objects to create the commit with, but you can also use</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tree_id</span><span class="p">,</span> <span class="s">&quot;28873d96b4e8f4e33ea30f4c682fd325f7ba56ac&quot;</span><span class="p">);</span>
  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">parent_id</span><span class="p">,</span> <span class="s">&quot;f0877d0b841d75172ec404fc9370173dfffc20d1&quot;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>Here we actually create the commit object with a single call with all the values we need to create
the commit.  The SHA key is written to the <code>commit_id</code> variable here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_commit_create_v</span><span class="p">(</span>
    <span class="o">&amp;</span><span class="n">commit_id</span><span class="p">,</span> <span class="cm">/* out id */</span>
    <span class="n">repo</span><span class="p">,</span>
    <span class="nb">NULL</span><span class="p">,</span> <span class="cm">/* do not update the HEAD */</span>
    <span class="n">author</span><span class="p">,</span>
    <span class="n">cmtter</span><span class="p">,</span>
    <span class="s">&quot;example commit&quot;</span><span class="p">,</span>
    <span class="o">&amp;</span><span class="n">tree_id</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">parent_id</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Now we can take a look at the commit SHA we&rsquo;ve generated.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid_fmt</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">commit_id</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;New Commit: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Tag_Parsing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Tag_Parsing">&#182;</a>
        </div>
        <h4>Tag Parsing</h4>

<p>You can parse and create tags with the <a href="http://libgit2.github.com/libgit2/group__git__tag.html">tag management API</a>, which functions very similarly
to the commit lookup, parsing and creation methods, since the objects themselves are very similar.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Tag Parsing*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">git_tag</span> <span class="o">*</span><span class="n">tag</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tmessage</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>We create an oid for the tag object if we know the SHA and look it up in the repository the same
way that we would a commit (or any other) object.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="s">&quot;bc422d45275aca289c51d79830b45cecebff7c3a&quot;</span><span class="p">);</span>

  <span class="n">error</span> <span class="o">=</span> <span class="n">git_tag_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tag</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>Now that we have the tag object, we can extract the information it generally contains: the target
(usually a commit object), the type of the target object (usually &lsquo;commit&rsquo;), the name (&lsquo;v1.0&rsquo;),
the tagger (a git_signature &ndash; name, email, timestamp), and the tag message.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_tag_target</span><span class="p">((</span><span class="n">git_object</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">commit</span><span class="p">,</span> <span class="n">tag</span><span class="p">);</span>
  <span class="n">git_tag_name</span><span class="p">(</span><span class="n">tag</span><span class="p">);</span>    <span class="c1">// &quot;test&quot;</span>
  <span class="n">git_tag_type</span><span class="p">(</span><span class="n">tag</span><span class="p">);</span>    <span class="c1">// GIT_OBJ_TAG (otype enum)</span>
  <span class="n">tmessage</span> <span class="o">=</span> <span class="n">git_tag_message</span><span class="p">(</span><span class="n">tag</span><span class="p">);</span> <span class="c1">// &quot;tag message\n&quot;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Tag Message: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmessage</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Tree_Parsing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Tree_Parsing">&#182;</a>
        </div>
        <h4>Tree Parsing</h4>

<p><a href="http://libgit2.github.com/libgit2/group__git__tree.html">Tree parsing</a> is a bit different than the other objects, in that we have a subtype which is the
tree entry.  This is not an actual object type in Git, but a useful structure for parsing and
traversing tree entries.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Tree Parsing*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

  <span class="n">git_tree</span> <span class="o">*</span><span class="n">tree</span><span class="p">;</span>
  <span class="n">git_tree_entry</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span>
  <span class="n">git_object</span> <span class="o">*</span><span class="n">objt</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>Create the oid and lookup the tree object just like the other objects.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="s">&quot;2a741c18ac5ff082a7caaec6e74db3075a1906b5&quot;</span><span class="p">);</span>
  <span class="n">git_tree_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tree</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-37'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-37">&#182;</a>
        </div>
        <p>Getting the count of entries in the tree so you can iterate over them if you want to.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">git_tree_entrycount</span><span class="p">(</span><span class="n">tree</span><span class="p">);</span> <span class="c1">// 3</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;tree entries: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>

  <span class="n">entry</span> <span class="o">=</span> <span class="n">git_tree_entry_byindex</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Entry name: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">git_tree_entry_name</span><span class="p">(</span><span class="n">entry</span><span class="p">));</span> <span class="c1">// &quot;hello.c&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-38'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-38">&#182;</a>
        </div>
        <p>You can also access tree entries by name if you know the name of the entry you&rsquo;re looking for.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">entry</span> <span class="o">=</span> <span class="n">git_tree_entry_byname</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s">&quot;hello.c&quot;</span><span class="p">);</span>
  <span class="n">git_tree_entry_name</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span> <span class="c1">// &quot;hello.c&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p>Once you have the entry object, you can access the content or subtree (or commit, in the case
of submodules) that it points to.  You can also get the mode if you want.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_tree_entry_2object</span><span class="p">(</span><span class="o">&amp;</span><span class="n">objt</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">entry</span><span class="p">);</span> <span class="c1">// blob</span></pre></div>
      </td>
    </tr>
    <tr id='section-Blob_Parsing'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Blob_Parsing">&#182;</a>
        </div>
        <h4>Blob Parsing</h4>

<p>The last object type is the simplest and requires the least parsing help. Blobs are just file
contents and can contain anything, there is no structure to it. The main advantage to using the
<a href="http://libgit2.github.com/libgit2/group__git__blob.html">simple blob api</a> is that when you&rsquo;re creating blobs you don&rsquo;t have to calculate the size
of the content.  There is also a helper for reading a file from disk and writing it to the db and
getting the oid back so you don&rsquo;t have to do all those steps yourself.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Blob Parsing*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">git_blob</span> <span class="o">*</span><span class="n">blob</span><span class="p">;</span>

  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="s">&quot;af7574ea73f7b166f869ef1a39be126d9a186ae0&quot;</span><span class="p">);</span>
  <span class="n">git_blob_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blob</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Blob Size: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">git_blob_rawsize</span><span class="p">(</span><span class="n">blob</span><span class="p">));</span> <span class="c1">// 8</span>
  <span class="n">git_blob_rawcontent</span><span class="p">(</span><span class="n">blob</span><span class="p">);</span> <span class="c1">// &quot;content&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-Revwalking'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Revwalking">&#182;</a>
        </div>
        <h3>Revwalking</h3>

<p>The libgit2 <a href="http://libgit2.github.com/libgit2/group__git__revwalk.html">revision walking api</a> provides methods to traverse the directed graph created
by the parent pointers of the commit objects.  Since all commits point back to the commit that
came directly before them, you can walk this parentage as a graph and find all the commits that
were ancestors of (reachable from) a given starting point.  This can allow you to create <code>git log</code>
type functionality.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Revwalking*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">git_revwalk</span> <span class="o">*</span><span class="n">walk</span><span class="p">;</span>
  <span class="n">git_commit</span> <span class="o">*</span><span class="n">wcommit</span><span class="p">;</span>

  <span class="n">git_oid_mkstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="s">&quot;f0877d0b841d75172ec404fc9370173dfffc20d1&quot;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-42'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-42">&#182;</a>
        </div>
        <p>To use the revwalker, create a new walker, tell it how you want to sort the output and then push
one or more starting points onto the walker.  If you want to emulate the output of <code>git log</code> you
would push the SHA of the commit that HEAD points to into the walker and then start traversing them.
You can also &lsquo;hide&rsquo; commits that you want to stop at or not see any of their ancestors.  So if you
want to emulate <code>git log branch1..branch2</code>, you would push the oid of <code>branch2</code> and hide the oid
of <code>branch1</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_revwalk_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">walk</span><span class="p">,</span> <span class="n">repo</span><span class="p">);</span>
  <span class="n">git_revwalk_sorting</span><span class="p">(</span><span class="n">walk</span><span class="p">,</span> <span class="n">GIT_SORT_TOPOLOGICAL</span> <span class="o">|</span> <span class="n">GIT_SORT_REVERSE</span><span class="p">);</span>
  <span class="n">git_revwalk_push</span><span class="p">(</span><span class="n">walk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>

  <span class="k">const</span> <span class="n">git_signature</span> <span class="o">*</span><span class="n">cauth</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cmsg</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-43'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-43">&#182;</a>
        </div>
        <p>Now that we have the starting point pushed onto the walker, we can start asking for ancestors. It
will return them in the sorting order we asked for as commit oids.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">while</span> <span class="p">((</span><span class="n">git_revwalk_next</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oid</span><span class="p">,</span> <span class="n">walk</span><span class="p">))</span> <span class="o">==</span> <span class="n">GIT_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">git_commit_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wcommit</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oid</span><span class="p">);</span>
    <span class="n">cmsg</span>  <span class="o">=</span> <span class="n">git_commit_message_short</span><span class="p">(</span><span class="n">wcommit</span><span class="p">);</span>
    <span class="n">cauth</span> <span class="o">=</span> <span class="n">git_commit_author</span><span class="p">(</span><span class="n">wcommit</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cmsg</span><span class="p">,</span> <span class="n">cauth</span><span class="o">-&gt;</span><span class="n">email</span><span class="p">);</span>
    <span class="n">git_commit_close</span><span class="p">(</span><span class="n">wcommit</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-44'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-44">&#182;</a>
        </div>
        <p>Like the other objects, be sure to free the revwalker when you&rsquo;re done to prevent memory leaks.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_revwalk_free</span><span class="p">(</span><span class="n">walk</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-Index_File_Manipulation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Index_File_Manipulation">&#182;</a>
        </div>
        <h3>Index File Manipulation</h3>

<p>The <a href="http://libgit2.github.com/libgit2/group__git__index.html">index file API</a> allows you to read, traverse, update and write the Git index file
(sometimes thought of as the staging area).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Index Walking*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

  <span class="n">git_index</span> <span class="o">*</span><span class="n">index</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">ecount</span><span class="p">;</span>
  <span class="n">git_index_entry</span> <span class="o">**</span><span class="n">entries</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-46'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-46">&#182;</a>
        </div>
        <p>You can either open the index from the standard location in an open repository, as we&rsquo;re doing
here, or you can open and manipulate any index file with <code>git_index_open_bare()</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_index_open_inrepo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">index</span><span class="p">,</span> <span class="n">repo</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-47'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-47">&#182;</a>
        </div>
        <p>You need to populate the index in memory with the contents of the index file to begin.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_index_read</span><span class="p">(</span><span class="n">index</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-48'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-48">&#182;</a>
        </div>
        <p>For each entry in the index, you can get a bunch of information including the SHA (oid), path
and mode which map to the tree objects that are written out.  It also has filesystem properties
to help determine what to inspect for changes (ctime, mtime, dev, ino, uid, gid, file_size and flags)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">ecount</span> <span class="o">=</span> <span class="n">git_index_entrycount</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ecount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">git_index_entry</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="n">git_index_get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;path: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;mtime: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">mtime</span><span class="p">.</span><span class="n">seconds</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;fs: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">file_size</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">git_index_free</span><span class="p">(</span><span class="n">index</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-References'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-References">&#182;</a>
        </div>
        <h3>References</h3>

<p>The <a href="http://libgit2.github.com/libgit2/refs_8h.html">reference API</a> allows you to list, resolve, create and update references such as
branches, tags and remote references (everything in the .git/refs directory).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">*Reference Listing*</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-50'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-50">&#182;</a>
        </div>
        <p>Here we will implement something like <code>git for-each-ref</code> simply listing out all available
references and the object SHA they resolve to.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_strarray</span> <span class="n">ref_list</span><span class="p">;</span>
  <span class="n">git_reference_listall</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref_list</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">GIT_REF_LISTALL</span><span class="p">);</span>

  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">refname</span><span class="p">;</span>
  <span class="n">git_reference</span> <span class="o">*</span><span class="n">ref</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-51'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-51">&#182;</a>
        </div>
        <p>Now that we have the list of reference names, we can lookup each ref one at a time and
resolve them to the SHA, then print both values out.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ref_list</span><span class="p">.</span><span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">refname</span> <span class="o">=</span> <span class="n">ref_list</span><span class="p">.</span><span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">git_reference_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref</span><span class="p">,</span> <span class="n">repo</span><span class="p">,</span> <span class="n">refname</span><span class="p">);</span>
    <span class="n">git_oid_fmt</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">git_reference_oid</span><span class="p">(</span><span class="n">ref</span><span class="p">));</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">refname</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">git_strarray_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref_list</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-52'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-52">&#182;</a>
        </div>
        <p>Finally, when you&rsquo;re done with the repository, you can free it as well.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">git_repository_free</span><span class="p">(</span><span class="n">repo</span><span class="p">);</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
    </table>
</div>
</body>
